// Nextflow configuration for VITRA-E0
// Biokey-enabled whole genome sequencing pipeline

params {
    // Input files
    fastq_r1 = null
    fastq_r2 = null
    ref = null
    
    // Output
    outdir = "./results"
    
    // GIAB validation
    giab_truth = null
    validate_giab = false
    
    // Biokey settings
    biokey_required = false
    safety_level = "ROUTINE"
    
    // Parabricks settings
    parabricks_params = "${projectDir}/configs/parabricks_params.json"
}

profiles {
    local {
        process.executor = 'local'
        process.cpus = 8
        process.memory = '32 GB'
    }
    
    guix {
        process.executor = 'local'
        process.container = 'guix'
        process.containerOptions = '--pure'
    }
    
    gpu {
        process.clusterOptions = '--gres=gpu:4'
        process.queue = 'gpu'
    }
    
    biokey {
        params.biokey_required = true
        params.safety_level = 'SENSITIVE'
    }
    
    airgap {
        params.airgap_mode = true
        params.network_disabled = true
    }
}

process {
    errorStrategy = 'retry'
    maxRetries = 3
    
    withName: ALIGN_FQ2BAM {
        cpus = 32
        memory = '64 GB'
        time = '2h'
    }
    
    withName: CALL_VARIANTS {
        cpus = 16
        memory = '32 GB'
        time = '1h'
    }
    
    withName: GIAB_VALIDATE {
        cpus = 8
        memory = '16 GB'
        time = '30m'
    }
    
    withName: PROVENANCE {
        cpus = 2
        memory = '4 GB'
        time = '10m'
    }
}

timeline {
    enabled = true
    file = "${params.outdir}/timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/dag.html"
}

manifest {
    name = 'VITRA-E0'
    author = 'QRATUM Project'
    description = 'Biokey-enabled sovereign whole genome sequencing pipeline'
    version = '1.0.0'
    nextflowVersion = '>=21.10.0'
}
