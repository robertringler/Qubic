# Default values for model-server
replicaCount: 2

image:
  repository: qratum/model-server
  pullPolicy: IfNotPresent
  tag: "1.0.0"

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

resources:
  # CPU variant (default)
  cpu:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "2000m"
  
  # GPU variant
  gpu:
    requests:
      memory: "4Gi"
      cpu: "2000m"
      nvidia.com/gpu: 1
    limits:
      memory: "16Gi"
      cpu: "8000m"
      nvidia.com/gpu: 1

# Use CPU by default, set to 'gpu' for GPU workloads
variant: cpu

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

env:
  - name: LOG_LEVEL
    value: "INFO"
  - name: MODEL_PATH
    value: "/models"
  - name: AUTH_TOKEN
    valueFrom:
      secretKeyRef:
        name: model-server-secret
        key: auth-token

volumes:
  - name: models
    persistentVolumeClaim:
      claimName: model-server-pvc

volumeMounts:
  - name: models
    mountPath: /models
    readOnly: true

livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  capabilities:
    drop:
      - ALL

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/metrics"

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - model-server
          topologyKey: kubernetes.io/hostname
