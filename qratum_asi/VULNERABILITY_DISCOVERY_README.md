# QRATUM Discovery Engine - Vulnerability Science

## Overview

The QRATUM Discovery Engine is a **defensive-only vulnerability analysis system** that identifies, quantifies, and mitigates latent structural vulnerabilities across the QRATUM stack. It operates in non-exploitative scientific mode, focusing on:

- System health assessment
- Risk quantification
- Defensive mitigation strategies

**No exploit paths, penetration methods, or evasion tactics are generated.**

## Architecture

The Discovery Engine implements eight core components as specified in the unified vulnerability science framework:

### I. System Formalization

Enumerates all subsystems and interfaces, constructing a dependency graph G(V,E) where edges represent functional coupling.

```python
from qratum_asi.core.vulnerability_discovery import (
    VulnerabilityDiscoveryEngine,
    Subsystem,
    Interface,
    SubsystemType,
    InterfaceType
)

engine = VulnerabilityDiscoveryEngine()

# Enumerate subsystems
subsystem = Subsystem(
    subsystem_id="genomics_001",
    name="VITRA-E0 Genomics Pipeline",
    subsystem_type=SubsystemType.GENOMICS_PIPELINE,
    description="Deterministic WGS pipeline",
    interfaces=["if1", "if2"],
    dependencies=["data_ingestion_001"]
)
engine.enumerate_subsystem(subsystem)

# Register interfaces
interface = Interface(
    interface_id="if_001",
    name="Data to Genomics",
    interface_type=InterfaceType.DATA_FLOW,
    source_subsystem="data_ingestion_001",
    target_subsystem="genomics_001",
    protocol="gRPC"
)
engine.register_interface(interface)
```

### II. Latent Risk Field Construction

For each node v_i ∈ V, computes:

- **Defect density (ρ)**: Latent defects per unit of complexity
- **Resilience elasticity (Er)**: System's recovery capability (0-1 scale)
- **Coupling volatility (σC)**: Variance in inter-module coupling
- **Recovery half-life (τ)**: Time to recover 50% after disruption (seconds)

```python
metrics = engine.compute_latent_risk_metrics("genomics_001")
print(f"Defect density: {metrics.defect_density:.3f}")
print(f"Resilience: {metrics.resilience_elasticity:.3f}")
print(f"Coupling volatility: {metrics.coupling_volatility:.3f}")
print(f"Recovery half-life: {metrics.recovery_half_life:.1f}s")
```

### III. Entropy & Blind-Zone Detection

Estimates local entropy fields across:

- Data flow
- Execution scheduling
- Governance decision loops
- Genomic inference paths

Flags bottlenecks where H_local >> H̄ as **structural blind-zones**.

```python
bottlenecks = engine.detect_entropy_bottlenecks()
for bn in bottlenecks:
    print(f"[{bn.severity}] {bn.subsystem_id}: {bn.description}")
```

### IV. Coupling Drift Surveillance

Tracks time-derivatives of inter-module coupling: dC/dt

Identifies metastable clusters with super-linear risk amplification.

```python
drifts = engine.track_coupling_drift()
metastable = [d for d in drifts if d.is_metastable]
print(f"Metastable clusters detected: {len(metastable)}")
```

### V. Phase-Transition Modeling

Defines system health: m(t) = 1 - L(t)/L_crit

Detects collapse precursors:

- Variance spikes
- Entropy localization
- Resilience half-life compression

```python
phase_risk = engine.model_phase_transition()
print(f"System health: {phase_risk.system_health:.1%}")
print(f"Collapse probability: {phase_risk.collapse_probability:.1%}")
print(f"Precursors: {phase_risk.precursor_signals}")
```

### VI. Metrics Output

Generates comprehensive vulnerability metrics table:

| Subsystem | ρ | Er | σC | τ (s) | Entropy Bottleneck | Phase Risk |
|-----------|---|----|----|-------|-------------------|------------|
| VITRA-E0  | 0.32 | 0.83 | 0.00 | 360.0 | NO | MEDIUM |
| AION      | 0.72 | 0.77 | 0.13 | 78.0  | NO | HIGH   |

```python
report = engine.generate_metrics_report()
table = engine.format_metrics_table(report)
print(table)
```

### VII. Invariant Failure Signatures

Extracts domain-independent fingerprints of degradation across QRATUM telemetry:

```python
signatures = report.invariant_signatures
for sig in signatures:
    print(f"- {sig}")
```

### VIII. Defensive Mitigation Architecture

Produces:

- Design-time immunization doctrine
- Continuous sensing layer specification
- Entropy budgeting framework
- Epistemic calibration loops

```python
for rec in report.mitigation_recommendations:
    print(f"- {rec}")
```

## Usage

### Command Line

```bash
# Run vulnerability discovery (default mode)
python3 run_discovery_engine.py
python3 run_discovery_engine.py vulnerability

# Run Q-FORGE discovery mode
python3 run_discovery_engine.py qforge
```

### Programmatic Usage

```python
from qratum_asi.examples.vulnerability_discovery_demo import main

# Run full QRATUM stack analysis
main()
```

### Custom Analysis

```python
from qratum_asi.core.vulnerability_discovery import VulnerabilityDiscoveryEngine

# Initialize engine
engine = VulnerabilityDiscoveryEngine()

# Add your subsystems and interfaces
# ... (see examples above)

# Generate report
report = engine.generate_metrics_report()

# Export to JSON
engine.export_report_json(report, "vulnerability_report.json")

# Display formatted table
print(engine.format_metrics_table(report))
```

## Subsystem Types

The engine supports the following QRATUM subsystem types:

- `GENOMICS_PIPELINE`: VITRA-E0 genomic analysis pipeline
- `AION_RUNTIME`: Deterministic execution runtime
- `DATA_INGESTION`: Secure data intake layer
- `ORCHESTRATION`: Workflow orchestration engine
- `GOVERNANCE`: Dual-control governance layer
- `ECONOMIC_CONTROL`: Resource allocation and economics
- `MERKLE_CHAIN`: Cryptographic provenance ledger
- `CONTRACT_ENGINE`: Deterministic contract execution
- `QUANTUM_KERNEL`: Quantum computing integration
- `MEMORY_MANAGER`: Memory allocation and management
- `SCHEDULER`: Deterministic task scheduling

## Interface Types

Supported interface types for subsystem coupling:

- `DATA_FLOW`: Data stream between components
- `CONTROL_FLOW`: Control signals and commands
- `EVENT_BUS`: Event-driven messaging
- `RPC_CALL`: Remote procedure calls
- `SHARED_MEMORY`: Shared memory segments
- `MESSAGE_QUEUE`: Asynchronous message queues

## Metrics Reference

### Defect Density (ρ)

Estimated latent defects per unit of complexity. Computed based on:

- Number of interfaces and dependencies
- Subsystem type risk profile
- Historical metrics (if available)

**Interpretation:**

- ρ < 1.0: Low defect density
- 1.0 ≤ ρ < 3.0: Moderate defect density
- ρ ≥ 3.0: High defect density (requires attention)

### Resilience Elasticity (Er)

System's ability to recover from perturbations (0-1 scale).

**Interpretation:**

- Er > 0.7: High resilience
- 0.4 ≤ Er ≤ 0.7: Moderate resilience
- Er < 0.4: Low resilience (requires enhancement)

### Coupling Volatility (σC)

Variance in inter-module coupling strength.

**Interpretation:**

- σC < 0.3: Stable coupling
- 0.3 ≤ σC < 0.5: Moderate volatility
- σC ≥ 0.5: High volatility (potential instability)

### Recovery Half-Life (τ)

Time in seconds for system to recover 50% after disruption.

**Interpretation:**

- τ < 60s: Fast recovery
- 60s ≤ τ < 300s: Moderate recovery
- τ ≥ 300s: Slow recovery (optimization recommended)

### System Health (m)

Overall system health metric: m(t) = 1 - L(t)/L_crit

**Interpretation:**

- m > 0.7: Healthy system
- 0.4 ≤ m ≤ 0.7: Moderate health
- m < 0.4: Poor health (immediate action required)

### Collapse Probability

Probability of system collapse based on health and precursor signals.

**Interpretation:**

- P < 0.3: Low risk
- 0.3 ≤ P < 0.6: Moderate risk
- P ≥ 0.6: High risk (urgent mitigation needed)

## Output Formats

### Console Table

The `format_metrics_table()` method produces a human-readable table:

```
========================================================================================================================
QRATUM VULNERABILITY METRICS REPORT
Timestamp: 2025-12-26T07:50:35.868664
========================================================================================================================

SUBSYSTEM METRICS:
------------------------------------------------------------------------------------------------------------------------
Subsystem                      ρ          Er         σC         τ (s)      H_local    Entropy BN      Phase Risk
------------------------------------------------------------------------------------------------------------------------
VITRA-E0 Genomics Pipeline     0.320      0.833      0.000      360.0      2.000      NO              MEDIUM
...
```

### JSON Export

The `export_report_json()` method produces a structured JSON file:

```json
{
  "timestamp": "2025-12-26T07:50:35.868664",
  "subsystems": [...],
  "metrics": {
    "genomics_001": {
      "defect_density": 0.32,
      "resilience_elasticity": 0.833,
      "coupling_volatility": 0.0,
      "recovery_half_life": 360.0,
      "entropy_local": 2.0,
      "entropy_average": 1.8
    }
  },
  "entropy_bottlenecks": [...],
  "coupling_drifts": [...],
  "phase_risk": {...},
  "invariant_signatures": [...],
  "mitigation_recommendations": [...]
}
```

## Termination Conditions

The Discovery Engine completes when:

1. ✓ Vulnerability manifolds are mapped
2. ✓ Phase-transition precursors are statistically characterized
3. ✓ Complete defensive resilience doctrine is delivered

All conditions are verified and reported at the end of each analysis run.

## Integration with QRATUM-ASI

The Discovery Engine integrates with the QRATUM-ASI safety framework:

- Uses ASI safety levels for risk classification
- Integrates with contract system for auditing
- Leverages Q-REALITY knowledge for historical analysis
- Connects to Q-FORGE for hypothesis-driven vulnerability discovery

## Safety Guarantees

The Discovery Engine operates under strict safety constraints:

1. **Defensive Only**: No exploit generation or attack simulation
2. **Read-Only Analysis**: Does not modify system state
3. **Privacy Preserving**: Does not access sensitive data
4. **Audit Logged**: All analyses are recorded in Merkle chain
5. **Human Oversight**: Critical findings require human review

## References

- QRATUM Architecture: `/docs/ARCHITECTURE.md`
- QRATUM-ASI Safety Framework: `qratum_asi/README.md`
- System Modeling: `qratum_asi/core/system_model.py`
- Vulnerability Discovery Theory: Problem statement specification

## License

Apache 2.0 - See LICENSE file for details.
